#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct BrowserTab {
    int pageID;
    char url[100];
    struct BrowserTab *next;
    struct BrowserTab *prev;
};
struct BrowserTab *head = NULL;
struct BrowserTab *current = NULL;
int idCounter = 1;
struct BrowserTab* makeTab(char address[]) {
    struct BrowserTab *temp = malloc(sizeof(struct BrowserTab));
    if (temp == NULL) {
        printf("Memory not allocated!\n");
        exit(1);
    }
    temp->pageID = idCounter++;
    strcpy(temp->url, address);
    temp->prev = NULL;
    temp->next = NULL;
    return temp;
}
void openNewPage() {
    char address[100];
    printf("Enter URL: ");
    scanf("%s", address);

    struct BrowserTab *newTab = makeTab(address);
    if (head == NULL) {
        head = newTab;
        current = newTab;
    } else {
        newTab->prev = current;
        newTab->next = current->next;
        if (current->next != NULL) {
            current->next->prev = newTab;
        }
        current->next = newTab;
        current = newTab;
    }
    printf("Opened: [%d] %s\n", current->pageID, current->url);
}

void nextTab() {
    if (current != NULL && current->next != NULL) {
        current = current->next;
        printf("Now at: [%d] %s\n", current->pageID, current->url);
    } else {
        printf("No next tab!\n");
    }
}

void prevTab() {
    if (current != NULL && current->prev != NULL) {
        current = current->prev;
        printf("Now at: [%d] %s\n", current->pageID, current->url);
    } else {
        printf("No previous tab!\n");
    }
}

void showTab() {
    if (current != NULL) {
        printf("Current tab: [%d] %s\n", current->pageID, current->url);
    } else {
        printf("No tabs open!\n");
    }
}
void closeTab() {
    if (current == NULL) {
        printf("No tab to close!\n");
        return;
    }

    printf("Closing: [%d] %s\n", current->pageID, current->url);

    if (current->prev != NULL)
        current->prev->next = current->next;
    if (current->next != NULL)
        current->next->prev = current->prev;

    struct BrowserTab *temp = current;

    if (current->next != NULL)
        current = current->next;
    else
        current = current->prev;

    if (temp == head)
        head = temp->next;

    free(temp);

    if (current != NULL)
        printf("Now at: [%d] %s\n", current->pageID, current->url);
    else
        printf("No tabs left!\n");
}

void showHistory() {
    if (head == NULL) {
        printf("No tabs in history!\n");
        return;
    }

    struct BrowserTab *temp = head;
    printf("History:\n");
    while (temp != NULL) {
        printf("[%d] %s\n", temp->pageID, temp->url);
        temp = temp->next;
    }
}

int main() {
    int choice;

    do {
        printf("\nBrowser Menu\n");
        printf("1. Open New Page\n");
        printf("2. Next Tab\n");
        printf("3. Previous Tab\n");
        printf("4. Show Current Tab\n");
        printf("5. Close Current Tab\n");
        printf("6. Show History\n");
        printf("0. Exit\n");
        printf("Enter choice: ");
        scanf("%d", &choice);

        switch(choice) {
            case 1: openNewPage(); break;
            case 2: nextTab(); break;
            case 3: prevTab(); break;
            case 4: showTab(); break;
            case 5: closeTab(); break;
            case 6: showHistory(); break;
            case 0: printf("Exiting...\n"); break;
            default: printf("Invalid choice!\n");
        }
    } while (choice != 0);

    return 0;
}
